id: https://w3id.org/nsrr/sleep-cde
name: sleep-cde-schema
title: Sleep Common Data Elements Schema
description: >-
  A compact, reusable LinkML schema for sleep research common data elements (CDEs).
  Designed to support cross-dataset harmonization by separating measurement semantics
  from acquisition/scoring protocol modifiers. Target: 40-120 canonical CDEs organized
  into ~20 concept groups, with explicit modifier axes for sleep stage, body position,
  respiratory event definitions, and PSG type.
license: MIT
version: 2.0.0
default_prefix: sleep
default_range: string

prefixes:
  sleep: https://w3id.org/nsrr/sleep-cde/
  linkml: https://w3id.org/linkml/
  schema: http://schema.org/
  NCIT: http://purl.obolibrary.org/obo/NCIT_
  HP: http://purl.obolibrary.org/obo/HP_
  SNOMED: http://snomed.info/id/
  LOINC: https://loinc.org/

imports:
  - linkml:types

# ==============================================================================
# SECTION A: CONCEPT GROUPS (organized as class hierarchy comments)
# ==============================================================================
# 1.  Demographics & Socioeconomic
# 2.  Anthropometry & Physical Measurements
# 3.  Vital Signs (Blood Pressure, Heart Rate)
# 4.  Sleep Architecture (Staging, Efficiency, Latency)
# 5.  Sleep Timing & Circadian
# 6.  Respiratory Events - Apneas
# 7.  Respiratory Events - Hypopneas
# 8.  Respiratory Events - Combined Indices (AHI, RDI)
# 9.  Oxygen Saturation Metrics
# 10. Arousals
# 11. Limb Movements (PLM)
# 12. Body Position During Sleep
# 13. Heart Rate Variability
# 14. Signal Quality Metrics
# 15. Sleep Questionnaires - Sleepiness (ESS)
# 16. Sleep Questionnaires - Sleep Quality (PSQI)
# 17. Sleep Questionnaires - Insomnia/Disturbance
# 18. Sleep Questionnaires - Chronotype
# 19. General Health Questionnaires (Depression, Anxiety, QoL)
# 20. Medical History & Comorbidities
# 21. Laboratory Tests
# 22. Actigraphy Measures
# 23. Treatment Adherence (CPAP)
# 24. Administrative/Study Metadata
# 25. Snoring Metrics
# 26. CO2/Capnography Metrics
# 27. Neurobehavioral Performance (PVT, Cognitive Tests)
# 28. Pediatric-Specific Measures
# 29. Sleep Apnea Screening Questionnaires (Berlin, STOP-BANG)
# 30. PROMIS Sleep Measures
# ==============================================================================

# ==============================================================================
# SECTION B: ENUMERATIONS (Modifier Axes + Value Sets)
# ==============================================================================

enums:
  # ============================================================================
  # MODIFIER AXIS ENUMS
  # ============================================================================

  SleepStageEnum:
    description: Sleep stage for stratified measurements
    permissible_values:
      all_sleep:
        description: All sleep stages combined (total sleep time)
      wake:
        description: Wake after sleep onset
      nrem:
        description: All NREM sleep (N1+N2+N3)
      n1:
        description: Stage N1 (light sleep)
      n2:
        description: Stage N2 (intermediate sleep)
      n3:
        description: Stage N3 (slow wave/deep sleep)
      rem:
        description: REM sleep

  BodyPositionEnum:
    description: Body position during sleep for stratified measurements
    permissible_values:
      all_positions:
        description: All positions combined
      supine:
        description: Supine (back) position
      non_supine:
        description: Non-supine (lateral/prone combined)
      lateral:
        description: Lateral (side) position
      prone:
        description: Prone (stomach) position
      upright:
        description: Upright/sitting position

  PSGTypeEnum:
    description: Type of polysomnography study
    permissible_values:
      type_i:
        description: Type I attended in-lab PSG with technician
      type_ii:
        description: Type II unattended comprehensive portable PSG
      type_iii:
        description: Type III limited channel home sleep test
      type_iv:
        description: Type IV single/dual channel (oximetry-based)
      actigraphy:
        description: Actigraphy-based sleep estimation
      questionnaire:
        description: Self-reported/questionnaire-based

  ApneaTypeEnum:
    description: Classification of apnea events
    permissible_values:
      all:
        description: All apnea types combined (obstructive + central + mixed)
      obstructive:
        description: Obstructive apneas only
      central:
        description: Central apneas only
      mixed:
        description: Mixed apneas only

  HypopneaDefinitionEnum:
    description: Hypopnea scoring rule definition
    permissible_values:
      aasm_2007_recommended:
        description: AASM 2007 - 50% flow reduction + 3% desat OR arousal
      aasm_2007_alternative:
        description: AASM 2007 - 50% flow reduction + 4% desat
      aasm_2012:
        description: AASM 2012 - 30% flow reduction + 3% desat OR arousal
      aasm_2015_1a:
        description: AASM 2015 v2.2 Rule 1A - 30% flow reduction + 3% desat OR arousal
      aasm_2015_1b:
        description: AASM 2015 v2.2 Rule 1B - 30% flow reduction + 4% desat
      chicago_1999:
        description: Chicago 1999 - discernible flow reduction + 3% desat OR arousal
      desat_3_only:
        description: Any reduction with 3% desaturation (no arousal criterion)
      desat_4_only:
        description: Any reduction with 4% desaturation (no arousal criterion)
      any_reduction:
        description: Any discernible flow reduction (no desat/arousal criterion)

  DesaturationThresholdEnum:
    description: Oxygen desaturation threshold for event scoring
    permissible_values:
      none:
        description: No desaturation threshold applied
      desat_2pct:
        description: 2% desaturation threshold
      desat_3pct:
        description: 3% desaturation threshold
      desat_4pct:
        description: 4% desaturation threshold
      desat_5pct:
        description: 5% desaturation threshold

  ArousalRequirementEnum:
    description: Arousal criterion for respiratory event scoring
    permissible_values:
      with_or_without:
        description: Arousal not required (with or without arousal)
      required:
        description: Arousal required for event
      or_arousal:
        description: Either desaturation OR arousal required
      and_arousal:
        description: Both desaturation AND arousal required

  SummaryStatisticEnum:
    description: Type of summary statistic
    permissible_values:
      value:
        description: Single value or raw measurement
      mean:
        description: Arithmetic mean
      median:
        description: Median value
      min:
        description: Minimum value
      max:
        description: Maximum value
      sd:
        description: Standard deviation
      count:
        description: Count/number of events
      sum:
        description: Sum total
      percent:
        description: Percentage
      index:
        description: Rate per hour (events/hour)

  TimeFrameEnum:
    description: Time period for measurement aggregation
    permissible_values:
      full_night:
        description: Entire recording/sleep period
      first_half:
        description: First half of recording
      second_half:
        description: Second half of recording
      weekday:
        description: Weekday average
      weekend:
        description: Weekend average
      weekly:
        description: Full week average
      past_month:
        description: Past month recall period
      past_week:
        description: Past week recall period

  # ============================================================================
  # VALUE SET ENUMS
  # ============================================================================

  SexEnum:
    description: Biological sex
    permissible_values:
      male:
        description: Male
      female:
        description: Female
      intersex:
        description: Intersex
      unknown:
        description: Unknown

  EthnicityEnum:
    description: Ethnicity classification
    permissible_values:
      hispanic_or_latino:
        description: Hispanic or Latino
      not_hispanic_or_latino:
        description: Not Hispanic or Latino
      unknown:
        description: Unknown or not reported

  RaceEnum:
    description: Race classification
    permissible_values:
      white:
        description: White
      black_or_african_american:
        description: Black or African American
      asian:
        description: Asian
      american_indian_or_alaska_native:
        description: American Indian or Alaska Native
      native_hawaiian_or_pacific_islander:
        description: Native Hawaiian or Other Pacific Islander
      multiple:
        description: Multiple races
      other:
        description: Other race
      unknown:
        description: Unknown or not reported

  YesNoEnum:
    description: Binary yes/no response
    permissible_values:
      "yes":
        description: Yes
      "no":
        description: No

  YesNoUnknownEnum:
    description: Yes/no with unknown option
    permissible_values:
      "yes":
        description: Yes
      "no":
        description: No
      unknown:
        description: Unknown or not applicable

  FrequencyEnum:
    description: Frequency response scale (general)
    permissible_values:
      never:
        description: Never or not at all
      rarely:
        description: Rarely (less than once per week)
      sometimes:
        description: Sometimes (1-2 times per week)
      often:
        description: Often (3-4 times per week)
      always:
        description: Always or almost always

  LikertFrequency4Enum:
    description: 4-point Likert frequency scale
    permissible_values:
      not_during_past_month:
        description: Not during the past month
      less_than_once_a_week:
        description: Less than once a week
      once_or_twice_a_week:
        description: Once or twice a week
      three_or_more_times_a_week:
        description: Three or more times a week

  LikertAgreement5Enum:
    description: 5-point Likert agreement scale
    permissible_values:
      strongly_disagree:
        description: Strongly disagree
      disagree:
        description: Disagree
      neutral:
        description: Neither agree nor disagree
      agree:
        description: Agree
      strongly_agree:
        description: Strongly agree

  SleepQualityEnum:
    description: Subjective sleep quality rating
    permissible_values:
      very_good:
        description: Very good
      fairly_good:
        description: Fairly good
      fairly_bad:
        description: Fairly bad
      very_bad:
        description: Very bad

  ESSResponseEnum:
    description: Epworth Sleepiness Scale response options
    permissible_values:
      no_chance:
        description: Would never doze (0)
      slight_chance:
        description: Slight chance of dozing (1)
      moderate_chance:
        description: Moderate chance of dozing (2)
      high_chance:
        description: High chance of dozing (3)

  CESDResponseEnum:
    description: CES-D frequency response scale
    permissible_values:
      rarely:
        description: Rarely or none of the time (less than 1 day)
      some:
        description: Some or a little of the time (1-2 days)
      occasionally:
        description: Occasionally or moderate amount (3-4 days)
      most:
        description: Most or all of the time (5-7 days)

  PHQResponseEnum:
    description: PHQ-9/PHQ-8 frequency response scale
    permissible_values:
      not_at_all:
        description: Not at all (0)
      several_days:
        description: Several days (1)
      more_than_half:
        description: More than half the days (2)
      nearly_every_day:
        description: Nearly every day (3)

  GADResponseEnum:
    description: GAD-7 frequency response scale
    permissible_values:
      not_at_all:
        description: Not at all (0)
      several_days:
        description: Several days (1)
      more_than_half:
        description: More than half the days (2)
      nearly_every_day:
        description: Nearly every day (3)

  PROMISResponseEnum:
    description: PROMIS 5-point response scale
    permissible_values:
      not_at_all:
        description: Not at all (1)
      a_little_bit:
        description: A little bit (2)
      somewhat:
        description: Somewhat (3)
      quite_a_bit:
        description: Quite a bit (4)
      very_much:
        description: Very much (5)

  PROMISQualityEnum:
    description: PROMIS sleep quality scale
    permissible_values:
      very_poor:
        description: Very poor (1)
      poor:
        description: Poor (2)
      fair:
        description: Fair (3)
      good:
        description: Good (4)
      very_good:
        description: Very good (5)

  BerlinRiskEnum:
    description: Berlin Questionnaire risk categories
    permissible_values:
      low_risk:
        description: Low risk for OSA (0-1 positive categories)
      high_risk:
        description: High risk for OSA (2-3 positive categories)

  STOPBANGRiskEnum:
    description: STOP-BANG risk categories
    permissible_values:
      low_risk:
        description: Low risk (score 0-2)
      intermediate_risk:
        description: Intermediate risk (score 3-4)
      high_risk:
        description: High risk (score 5-8)

  SnoringFrequencyEnum:
    description: Snoring frequency response scale
    permissible_values:
      never:
        description: Never or almost never
      occasionally:
        description: Occasionally (1-2 nights/week)
      frequently:
        description: Frequently (3-4 nights/week)
      always:
        description: Always or almost always (5-7 nights/week)

  SnoringLoudnessEnum:
    description: Snoring loudness scale
    permissible_values:
      none:
        description: No snoring
      mild:
        description: Slightly louder than breathing
      moderate:
        description: As loud as talking
      loud:
        description: Louder than talking
      very_loud:
        description: Can be heard in adjacent rooms


# ==============================================================================
# SECTION C: SLOTS (Reusable Properties)
# ==============================================================================

slots:
  # ============================================================================
  # IDENTIFIER SLOTS
  # ============================================================================

  id:
    description: Unique identifier
    identifier: true
    range: string
    required: true

  dataset_id:
    description: Identifier for the source dataset/study
    range: string

  variable_id:
    description: Original variable name/identifier from source dataset
    range: string

  subject_id:
    description: Participant/subject identifier
    range: string

  visit_id:
    description: Visit/timepoint identifier
    range: string

  # ============================================================================
  # METADATA SLOTS
  # ============================================================================

  name:
    description: Human-readable name
    range: string

  label:
    description: Display label for variable
    range: string

  description:
    description: Detailed description
    range: string

  concept_path:
    description: Hierarchical concept path (folder structure)
    range: string

  tags:
    description: Concept tags associated with variable
    range: string
    multivalued: true

  units:
    description: Unit of measurement
    range: string

  value_type:
    description: Data type of the value
    range: string

  # ============================================================================
  # MODIFIER AXIS SLOTS
  # ============================================================================

  sleep_stage:
    description: Sleep stage context for measurement
    range: SleepStageEnum

  body_position:
    description: Body position context for measurement
    range: BodyPositionEnum

  psg_type:
    description: Type of polysomnography study
    range: PSGTypeEnum

  apnea_type:
    description: Type of apnea events included
    range: ApneaTypeEnum

  hypopnea_definition:
    description: Hypopnea scoring rule used
    range: HypopneaDefinitionEnum

  desaturation_threshold:
    description: Oxygen desaturation threshold for event scoring
    range: DesaturationThresholdEnum

  arousal_requirement:
    description: Arousal criterion for event scoring
    range: ArousalRequirementEnum

  summary_statistic:
    description: Type of summary statistic
    range: SummaryStatisticEnum

  time_frame:
    description: Time period for aggregation
    range: TimeFrameEnum

  # ============================================================================
  # DEMOGRAPHIC SLOTS (Concept Group 1)
  # ============================================================================

  age_years:
    description: Age in years
    range: float

  age_months:
    description: Age in months (for infants/children)
    range: float

  age_gt89:
    description: Flag indicating age greater than 89 years (for de-identification)
    range: YesNoEnum

  sex:
    description: Biological sex
    range: SexEnum

  ethnicity:
    description: Ethnicity
    range: EthnicityEnum

  race:
    description: Race
    range: RaceEnum

  education_years:
    description: Years of education completed
    range: integer

  employment_status:
    description: Current employment status
    range: string

  marital_status:
    description: Marital status
    range: string

  household_income:
    description: Household income category
    range: string

  # ============================================================================
  # ANTHROPOMETRY SLOTS (Concept Group 2)
  # ============================================================================

  height_cm:
    description: Height in centimeters
    range: float

  weight_kg:
    description: Weight in kilograms
    range: float

  bmi:
    description: Body mass index (kg/m^2)
    range: float

  bmi_percentile:
    description: BMI percentile (for pediatric)
    range: float

  bmi_zscore:
    description: BMI z-score (for pediatric)
    range: float

  neck_circumference_cm:
    description: Neck circumference in centimeters
    range: float

  waist_circumference_cm:
    description: Waist circumference in centimeters
    range: float

  hip_circumference_cm:
    description: Hip circumference in centimeters
    range: float

  waist_hip_ratio:
    description: Waist-to-hip ratio
    range: float

  # ============================================================================
  # VITAL SIGNS SLOTS (Concept Group 3)
  # ============================================================================

  systolic_bp_mmhg:
    description: Systolic blood pressure in mmHg
    range: float

  diastolic_bp_mmhg:
    description: Diastolic blood pressure in mmHg
    range: float

  heart_rate_bpm:
    description: Heart rate in beats per minute
    range: float

  respiratory_rate:
    description: Respiratory rate (breaths per minute)
    range: float

  temperature_celsius:
    description: Body temperature in Celsius
    range: float

  # ============================================================================
  # SLEEP ARCHITECTURE SLOTS (Concept Group 4)
  # ============================================================================

  total_sleep_time_min:
    description: Total sleep time (TST) in minutes
    range: float

  time_in_bed_min:
    description: Time in bed (TIB) in minutes
    range: float

  sleep_efficiency_pct:
    description: Sleep efficiency (TST/TIB * 100) as percentage
    range: float

  sleep_onset_latency_min:
    description: Sleep onset latency (SOL) in minutes
    range: float

  rem_latency_min:
    description: REM sleep latency in minutes
    range: float

  waso_min:
    description: Wake after sleep onset (WASO) in minutes
    range: float

  sleep_stage_duration_min:
    description: Duration in specified sleep stage (minutes)
    range: float

  sleep_stage_percent:
    description: Percentage of TST in specified sleep stage
    range: float

  num_stage_transitions:
    description: Number of sleep stage transitions
    range: integer

  num_awakenings:
    description: Number of awakenings during sleep period
    range: integer

  # ============================================================================
  # SLEEP TIMING SLOTS (Concept Group 5)
  # ============================================================================

  lights_off_time:
    description: Lights off / bedtime (HH:MM or decimal hours)
    range: string

  lights_on_time:
    description: Lights on / wake time (HH:MM or decimal hours)
    range: string

  sleep_onset_time:
    description: Sleep onset time
    range: string

  sleep_offset_time:
    description: Final awakening time
    range: string

  sleep_midpoint:
    description: Midpoint of sleep period
    range: string

  recording_start_time:
    description: PSG recording start time
    range: string

  recording_duration_min:
    description: Total recording duration in minutes
    range: float

  # ============================================================================
  # RESPIRATORY EVENT SLOTS (Concept Groups 6-8)
  # ============================================================================

  apnea_index:
    description: Apnea index (apneas per hour of sleep)
    range: float

  hypopnea_index:
    description: Hypopnea index (hypopneas per hour of sleep)
    range: float

  ahi:
    description: Apnea-hypopnea index (AHI) - events per hour of sleep
    range: float

  rdi:
    description: Respiratory disturbance index (RDI) - including RERAs
    range: float

  rera_index:
    description: Respiratory effort-related arousal index
    range: float

  apnea_count:
    description: Total number of apnea events
    range: integer

  hypopnea_count:
    description: Total number of hypopnea events
    range: integer

  respiratory_event_count:
    description: Total number of respiratory events
    range: integer

  mean_apnea_duration_sec:
    description: Mean duration of apnea events in seconds
    range: float

  max_apnea_duration_sec:
    description: Maximum apnea duration in seconds
    range: float

  mean_hypopnea_duration_sec:
    description: Mean duration of hypopnea events in seconds
    range: float

  # ============================================================================
  # OXYGEN SATURATION SLOTS (Concept Group 9)
  # ============================================================================

  spo2_mean_pct:
    description: Mean SpO2 during sleep (%)
    range: float

  spo2_min_pct:
    description: Minimum SpO2 during sleep (%)
    range: float

  spo2_nadir_pct:
    description: SpO2 nadir (lowest value) during sleep (%)
    range: float

  spo2_baseline_pct:
    description: Baseline/awake SpO2 (%)
    range: float

  desaturation_index:
    description: Oxygen desaturation index (events per hour)
    range: float

  time_below_90_pct_min:
    description: Time with SpO2 below 90% in minutes
    range: float

  time_below_90_pct_percent:
    description: Percentage of sleep time with SpO2 below 90%
    range: float

  time_below_88_pct_min:
    description: Time with SpO2 below 88% in minutes
    range: float

  mean_desaturation_pct:
    description: Mean desaturation magnitude (%)
    range: float

  # ============================================================================
  # AROUSAL SLOTS (Concept Group 10)
  # ============================================================================

  arousal_index:
    description: Arousal index (arousals per hour of sleep)
    range: float

  arousal_count:
    description: Total number of arousals
    range: integer

  respiratory_arousal_index:
    description: Respiratory-related arousal index
    range: float

  spontaneous_arousal_index:
    description: Spontaneous arousal index
    range: float

  plm_arousal_index:
    description: PLM-related arousal index
    range: float

  mean_arousal_duration_sec:
    description: Mean arousal duration in seconds
    range: float

  # ============================================================================
  # LIMB MOVEMENT SLOTS (Concept Group 11)
  # ============================================================================

  plm_index:
    description: Periodic limb movement index (PLMs per hour of sleep)
    range: float

  plm_count:
    description: Total number of periodic limb movements
    range: integer

  plms_with_arousal_index:
    description: PLMS with arousal index
    range: float

  plms_with_arousal_count:
    description: Number of PLMs with arousal
    range: integer

  limb_movement_index:
    description: Limb movement index (all LMs per hour)
    range: float

  # ============================================================================
  # BODY POSITION DURATION SLOTS (Concept Group 12)
  # ============================================================================

  supine_duration_min:
    description: Time in supine position during sleep (minutes)
    range: float

  supine_percent:
    description: Percentage of sleep in supine position
    range: float

  non_supine_duration_min:
    description: Time in non-supine position during sleep (minutes)
    range: float

  non_supine_percent:
    description: Percentage of sleep in non-supine position
    range: float

  lateral_duration_min:
    description: Time in lateral position during sleep (minutes)
    range: float

  prone_duration_min:
    description: Time in prone position during sleep (minutes)
    range: float

  # ============================================================================
  # HEART RATE VARIABILITY SLOTS (Concept Group 13)
  # ============================================================================

  hrv_sdnn_ms:
    description: SDNN - Standard deviation of NN intervals (ms)
    range: float

  hrv_rmssd_ms:
    description: RMSSD - Root mean square of successive differences (ms)
    range: float

  hrv_pnn50_pct:
    description: pNN50 - Percentage of successive NNs differing by >50ms
    range: float

  hrv_lf_power:
    description: Low frequency power (0.04-0.15 Hz)
    range: float

  hrv_hf_power:
    description: High frequency power (0.15-0.4 Hz)
    range: float

  hrv_lf_hf_ratio:
    description: LF/HF ratio
    range: float

  mean_heart_rate_sleep:
    description: Mean heart rate during sleep (bpm)
    range: float

  min_heart_rate_sleep:
    description: Minimum heart rate during sleep (bpm)
    range: float

  max_heart_rate_sleep:
    description: Maximum heart rate during sleep (bpm)
    range: float

  # ============================================================================
  # SIGNAL QUALITY SLOTS (Concept Group 14)
  # ============================================================================

  eeg_quality_pct:
    description: Percentage of EEG signal with acceptable quality
    range: float

  eog_quality_pct:
    description: Percentage of EOG signal with acceptable quality
    range: float

  emg_quality_pct:
    description: Percentage of EMG signal with acceptable quality
    range: float

  ecg_quality_pct:
    description: Percentage of ECG signal with acceptable quality
    range: float

  oximetry_quality_pct:
    description: Percentage of oximetry signal with acceptable quality
    range: float

  airflow_quality_pct:
    description: Percentage of airflow signal with acceptable quality
    range: float

  position_quality_pct:
    description: Percentage of position signal with acceptable quality
    range: float

  overall_study_quality:
    description: Overall PSG study quality rating
    range: string

  # ============================================================================
  # QUESTIONNAIRE SCORE SLOTS (Concept Groups 15-19)
  # ============================================================================

  ess_total_score:
    description: Epworth Sleepiness Scale total score (0-24)
    range: integer

  psqi_global_score:
    description: Pittsburgh Sleep Quality Index global score (0-21)
    range: integer

  psqi_component_score:
    description: PSQI component score (0-3)
    range: integer

  isi_total_score:
    description: Insomnia Severity Index total score (0-28)
    range: integer

  phq9_total_score:
    description: PHQ-9 depression score (0-27)
    range: integer

  phq8_total_score:
    description: PHQ-8 depression score (0-24)
    range: integer

  gad7_total_score:
    description: GAD-7 anxiety score (0-21)
    range: integer

  cesd_total_score:
    description: CES-D depression score
    range: integer

  sf36_physical_score:
    description: SF-36 Physical Component Summary score
    range: float

  sf36_mental_score:
    description: SF-36 Mental Component Summary score
    range: float

  fosq_total_score:
    description: FOSQ total score
    range: float

  fss_mean_score:
    description: Fatigue Severity Scale mean score
    range: float

  meq_score:
    description: Morningness-Eveningness Questionnaire score
    range: integer

  chronotype:
    description: Chronotype classification
    range: string

  # ============================================================================
  # PROMIS QUESTIONNAIRE SLOTS (Concept Group 30)
  # ============================================================================

  promis_sleep_disturbance_tscore:
    description: PROMIS Sleep Disturbance T-score
    range: float

  promis_sleep_disturbance_raw:
    description: PROMIS Sleep Disturbance raw score
    range: integer

  promis_sleep_impairment_tscore:
    description: PROMIS Sleep-Related Impairment T-score
    range: float

  promis_sleep_impairment_raw:
    description: PROMIS Sleep-Related Impairment raw score
    range: integer

  # ============================================================================
  # SCREENING QUESTIONNAIRE SLOTS (Concept Group 29)
  # ============================================================================

  berlin_category1_positive:
    description: Berlin Questionnaire Category 1 positive (snoring)
    range: YesNoEnum

  berlin_category2_positive:
    description: Berlin Questionnaire Category 2 positive (sleepiness)
    range: YesNoEnum

  berlin_category3_positive:
    description: Berlin Questionnaire Category 3 positive (BMI/hypertension)
    range: YesNoEnum

  berlin_total_positive:
    description: Number of positive Berlin categories (0-3)
    range: integer

  berlin_risk:
    description: Berlin Questionnaire risk classification
    range: BerlinRiskEnum

  stopbang_score:
    description: STOP-BANG total score (0-8)
    range: integer

  stopbang_risk:
    description: STOP-BANG risk classification
    range: STOPBANGRiskEnum

  # ============================================================================
  # PEDIATRIC QUESTIONNAIRE SLOTS (Concept Group 28)
  # ============================================================================

  chq_physical_score:
    description: Child Health Questionnaire Physical Summary Score
    range: float

  chq_psychosocial_score:
    description: Child Health Questionnaire Psychosocial Summary Score
    range: float

  osa18_total_score:
    description: OSA-18 Quality of Life total score
    range: integer

  osa18_sleep_disturbance:
    description: OSA-18 Sleep Disturbance domain score
    range: integer

  osa18_physical_symptoms:
    description: OSA-18 Physical Symptoms domain score
    range: integer

  osa18_emotional_distress:
    description: OSA-18 Emotional Distress domain score
    range: integer

  osa18_daytime_function:
    description: OSA-18 Daytime Function domain score
    range: integer

  osa18_caregiver_concern:
    description: OSA-18 Caregiver Concern domain score
    range: integer

  psq_srbd_score:
    description: Pediatric Sleep Questionnaire SRBD score
    range: float

  # ============================================================================
  # PEDIATRIC ANTHROPOMETRY SLOTS
  # ============================================================================

  gestational_age_weeks:
    description: Gestational age at birth in weeks
    range: float

  tonsil_size:
    description: Tonsil size grade (0-4)
    range: integer

  adenoid_size:
    description: Adenoid size/obstruction percentage
    range: float

  # ============================================================================
  # SURVEY ITEM SLOTS
  # ============================================================================

  instrument_id:
    description: Identifier for the survey instrument (e.g., ESS, PSQI, PHQ9)
    range: string

  item_id:
    description: Item number/identifier within instrument
    range: string

  item_text:
    description: Text of the survey question
    range: string

  response_value:
    description: Numeric response value
    range: integer

  response_text:
    description: Text representation of response
    range: string

  # ============================================================================
  # SNORING SLOTS (Concept Group 25)
  # ============================================================================

  snoring_frequency:
    description: Self-reported snoring frequency
    range: SnoringFrequencyEnum

  snoring_loudness:
    description: Self-reported snoring loudness
    range: SnoringLoudnessEnum

  snoring_duration_min:
    description: Duration of snoring during sleep (minutes)
    range: float

  snoring_percent:
    description: Percentage of sleep time with snoring
    range: float

  snoring_index:
    description: Snoring events per hour of sleep
    range: float

  # ============================================================================
  # CO2/CAPNOGRAPHY SLOTS (Concept Group 26)
  # ============================================================================

  etco2_mean:
    description: Mean end-tidal CO2 during sleep (mmHg)
    range: float

  etco2_peak:
    description: Peak end-tidal CO2 during sleep (mmHg)
    range: float

  etco2_baseline_wake:
    description: Baseline wake end-tidal CO2 (mmHg)
    range: float

  etco2_baseline_sleep:
    description: Baseline sleep end-tidal CO2 (mmHg)
    range: float

  time_co2_above_50_pct:
    description: Percentage of sleep time with CO2 > 50 mmHg
    range: float

  time_co2_above_45_pct:
    description: Percentage of sleep time with CO2 > 45 mmHg
    range: float

  # ============================================================================
  # NEUROBEHAVIORAL PERFORMANCE SLOTS (Concept Group 27)
  # ============================================================================

  pvt_mean_rt_ms:
    description: Psychomotor Vigilance Test mean reaction time (ms)
    range: float

  pvt_median_rt_ms:
    description: Psychomotor Vigilance Test median reaction time (ms)
    range: float

  pvt_lapse_count:
    description: PVT number of lapses (RT >= 500ms)
    range: integer

  pvt_false_start_count:
    description: PVT number of false starts
    range: integer

  pvt_fastest_10pct_rt:
    description: PVT mean of fastest 10% of reaction times (ms)
    range: float

  pvt_slowest_10pct_rt:
    description: PVT mean of slowest 10% of reaction times (ms)
    range: float

  kss_score:
    description: Karolinska Sleepiness Scale score (1-9)
    range: integer

  vas_sleepiness:
    description: Visual Analog Scale sleepiness rating
    range: float

  # ============================================================================
  # SLEEP FRAGMENTATION SLOTS (extension of Group 4)
  # ============================================================================

  sleep_fragmentation_index:
    description: Sleep fragmentation index from actigraphy
    range: float

  sleep_bout_count:
    description: Number of sleep bouts (continuous sleep periods)
    range: integer

  wake_bout_count:
    description: Number of wake bouts during sleep period
    range: integer

  mean_sleep_bout_duration_min:
    description: Mean duration of sleep bouts (minutes)
    range: float

  mean_wake_bout_duration_min:
    description: Mean duration of wake bouts (minutes)
    range: float

  # ============================================================================
  # NAP/DAYTIME SLEEP SLOTS (extension of Group 22)
  # ============================================================================

  nap_count:
    description: Number of daytime naps
    range: integer

  nap_duration_total_min:
    description: Total duration of naps (minutes)
    range: float

  nap_duration_mean_min:
    description: Mean duration of naps (minutes)
    range: float

  # ============================================================================
  # CENTRAL SLEEP APNEA SLOTS (extension of Groups 6-8)
  # ============================================================================

  central_apnea_index:
    description: Central apnea index (central apneas per hour)
    range: float

  central_apnea_count:
    description: Total number of central apnea events
    range: integer

  mixed_apnea_index:
    description: Mixed apnea index (mixed apneas per hour)
    range: float

  mixed_apnea_count:
    description: Total number of mixed apnea events
    range: integer

  obstructive_apnea_index:
    description: Obstructive apnea index (obstructive apneas per hour)
    range: float

  obstructive_apnea_count:
    description: Total number of obstructive apnea events
    range: integer

  # ============================================================================
  # ACTIGRAPHY SLOTS (Concept Group 22)
  # ============================================================================

  actigraphy_tst_min:
    description: Actigraphy-estimated total sleep time (minutes)
    range: float

  actigraphy_se_pct:
    description: Actigraphy-estimated sleep efficiency (%)
    range: float

  actigraphy_sol_min:
    description: Actigraphy-estimated sleep onset latency (minutes)
    range: float

  actigraphy_waso_min:
    description: Actigraphy-estimated WASO (minutes)
    range: float

  activity_count:
    description: Activity count from actigraphy
    range: float

  rest_interval_start:
    description: Rest interval start time from actigraphy
    range: string

  rest_interval_end:
    description: Rest interval end time from actigraphy
    range: string

  valid_days:
    description: Number of valid recording days
    range: integer

  # ============================================================================
  # TREATMENT ADHERENCE SLOTS (Concept Group 23)
  # ============================================================================

  cpap_usage_hours:
    description: CPAP usage in hours per night
    range: float

  cpap_usage_percent_days:
    description: Percentage of days with CPAP use
    range: float

  cpap_usage_percent_days_gt4h:
    description: Percentage of days with CPAP use >4 hours
    range: float

  cpap_pressure_cmh2o:
    description: CPAP pressure setting (cmH2O)
    range: float

  cpap_ahi_residual:
    description: Residual AHI on CPAP
    range: float

  cpap_leak_lpm:
    description: CPAP mask leak (L/min)
    range: float

  # ============================================================================
  # MEDICAL HISTORY SLOTS (Concept Group 20)
  # ============================================================================

  has_hypertension:
    description: History of hypertension
    range: YesNoUnknownEnum

  has_diabetes:
    description: History of diabetes
    range: YesNoUnknownEnum

  has_heart_disease:
    description: History of cardiovascular disease
    range: YesNoUnknownEnum

  has_stroke:
    description: History of stroke
    range: YesNoUnknownEnum

  has_depression:
    description: History of depression
    range: YesNoUnknownEnum

  has_anxiety:
    description: History of anxiety disorder
    range: YesNoUnknownEnum

  has_insomnia:
    description: History of insomnia
    range: YesNoUnknownEnum

  has_rls:
    description: History of restless legs syndrome
    range: YesNoUnknownEnum

  has_narcolepsy:
    description: History of narcolepsy
    range: YesNoUnknownEnum

  smoking_status:
    description: Smoking status
    range: string

  alcohol_use:
    description: Alcohol consumption frequency
    range: string

  # ============================================================================
  # RELATIONSHIP AND MAPPING SLOTS
  # ============================================================================

  canonical_slot:
    description: Reference to canonical CDE slot this variable maps to
    range: string

  modifiers:
    description: List of modifier values applied to canonical slot
    range: string
    multivalued: true

  mapping_confidence:
    description: Confidence level of mapping (exact, high, medium, low)
    range: string

  mapping_notes:
    description: Notes about the mapping
    range: string

  source_variable:
    description: Original source variable identifier
    range: string

  is_harmonized:
    description: Whether this is a harmonized/canonical variable
    range: boolean

  is_derived:
    description: Whether this is a derived/calculated variable
    range: boolean

  derivation_formula:
    description: Formula used to derive this variable
    range: string


# ==============================================================================
# SECTION D: CLASSES
# ==============================================================================

classes:
  # ============================================================================
  # CORE CLASSES
  # ============================================================================

  Dataset:
    description: A sleep research dataset/study
    slots:
      - id
      - name
      - description
      - tags
    slot_usage:
      id:
        pattern: "^[A-Z0-9_]+$"

  Variable:
    description: A variable definition from a source dataset
    slots:
      - id
      - dataset_id
      - variable_id
      - label
      - description
      - concept_path
      - tags
      - units
      - value_type
      - canonical_slot
      - modifiers
      - mapping_confidence
      - mapping_notes
      - is_harmonized
      - is_derived
      - derivation_formula

  VariableValue:
    description: An observed value for a variable
    slots:
      - id
      - variable_id
      - subject_id
      - visit_id
    attributes:
      value:
        description: The observed value (polymorphic)
        range: string

  CodeIdentifier:
    description: External code/identifier for a concept
    slots:
      - id
    attributes:
      system:
        description: Code system (e.g., SNOMED, LOINC, NCIT)
        range: string
      code:
        description: Code value
        range: string
      display:
        description: Display name
        range: string

  # ============================================================================
  # PROTOCOL CLASSES
  # ============================================================================

  AcquisitionProtocol:
    description: Protocol parameters for data acquisition
    slots:
      - id
      - name
      - description
      - psg_type
    attributes:
      device_type:
        description: Type of recording device
        range: string
      sensor_configuration:
        description: Sensor/channel configuration
        range: string
      sampling_rate_hz:
        description: Sampling rate in Hz
        range: float
      recording_environment:
        description: Recording environment (lab, home, etc.)
        range: string

  ScoringProtocol:
    description: Protocol parameters for sleep/event scoring
    slots:
      - id
      - name
      - description
      - hypopnea_definition
      - desaturation_threshold
      - arousal_requirement
    attributes:
      epoch_length_sec:
        description: Epoch length for staging in seconds (typically 30)
        range: integer
      staging_rules:
        description: Sleep staging rules used (e.g., AASM 2007, R&K)
        range: string
      scorer_id:
        description: Identifier for scorer or scoring center
        range: string
      interrater_reliability:
        description: Interrater reliability metric
        range: float

  # ============================================================================
  # SURVEY CLASSES
  # ============================================================================

  Instrument:
    description: A survey instrument or questionnaire
    slots:
      - id
      - name
      - description
    attributes:
      abbreviation:
        description: Standard abbreviation (e.g., ESS, PSQI)
        range: string
      version:
        description: Version of the instrument
        range: string
      num_items:
        description: Number of items
        range: integer
      score_range:
        description: Range of total score (e.g., "0-24")
        range: string
      citation:
        description: Citation for the instrument
        range: string

  SurveyItemResponse:
    description: A response to a single survey item
    slots:
      - id
      - subject_id
      - visit_id
      - instrument_id
      - item_id
      - item_text
      - response_value
      - response_text

  SurveyScore:
    description: A computed score from a survey instrument
    slots:
      - id
      - subject_id
      - visit_id
      - instrument_id
    attributes:
      score_type:
        description: Type of score (total, subscale, component)
        range: string
      score_name:
        description: Name of the score
        range: string
      score_value:
        description: Numeric score value
        range: float

  # ============================================================================
  # SLEEP DOMAIN MEASUREMENT CLASSES
  # ============================================================================

  SleepStudyRecord:
    description: A single sleep study observation with all measurements
    slots:
      - id
      - subject_id
      - visit_id
      - dataset_id
      - psg_type
      # Sleep Architecture
      - total_sleep_time_min
      - time_in_bed_min
      - sleep_efficiency_pct
      - sleep_onset_latency_min
      - rem_latency_min
      - waso_min
      - num_awakenings
      # Sleep Timing
      - lights_off_time
      - lights_on_time
      - sleep_onset_time
      - sleep_offset_time
      - recording_duration_min
    attributes:
      study_date:
        description: Date of sleep study
        range: date

  SleepStageMetric:
    description: Sleep staging metric stratified by stage
    slots:
      - id
      - subject_id
      - visit_id
      - sleep_stage
      - sleep_stage_duration_min
      - sleep_stage_percent
      - psg_type

  RespiratoryEventMetric:
    description: Respiratory event metric with full modifier context
    slots:
      - id
      - subject_id
      - visit_id
      - ahi
      - apnea_index
      - hypopnea_index
      - apnea_count
      - hypopnea_count
      # Modifiers
      - apnea_type
      - hypopnea_definition
      - desaturation_threshold
      - arousal_requirement
      - sleep_stage
      - body_position
      - psg_type
      - summary_statistic

  OxygenSaturationMetric:
    description: Oxygen saturation measurement with context
    slots:
      - id
      - subject_id
      - visit_id
      - spo2_mean_pct
      - spo2_min_pct
      - spo2_nadir_pct
      - spo2_baseline_pct
      - desaturation_index
      - time_below_90_pct_min
      - time_below_90_pct_percent
      # Modifiers
      - desaturation_threshold
      - sleep_stage
      - body_position
      - psg_type
      - summary_statistic

  ArousalMetric:
    description: Arousal measurement with context
    slots:
      - id
      - subject_id
      - visit_id
      - arousal_index
      - arousal_count
      - respiratory_arousal_index
      - spontaneous_arousal_index
      - plm_arousal_index
      # Modifiers
      - sleep_stage
      - body_position
      - psg_type

  LimbMovementMetric:
    description: Limb movement measurement with context
    slots:
      - id
      - subject_id
      - visit_id
      - plm_index
      - plm_count
      - plms_with_arousal_index
      - plms_with_arousal_count
      # Modifiers
      - sleep_stage
      - psg_type

  BodyPositionMetric:
    description: Body position duration measurement
    slots:
      - id
      - subject_id
      - visit_id
      - supine_duration_min
      - supine_percent
      - non_supine_duration_min
      - non_supine_percent
      - lateral_duration_min
      - prone_duration_min
      - psg_type

  HeartRateMetric:
    description: Heart rate and HRV measurement
    slots:
      - id
      - subject_id
      - visit_id
      - mean_heart_rate_sleep
      - min_heart_rate_sleep
      - max_heart_rate_sleep
      - hrv_sdnn_ms
      - hrv_rmssd_ms
      - hrv_pnn50_pct
      - hrv_lf_power
      - hrv_hf_power
      - hrv_lf_hf_ratio
      # Modifiers
      - sleep_stage
      - body_position
      - psg_type
      - time_frame

  # ============================================================================
  # DEMOGRAPHIC/CLINICAL CLASSES
  # ============================================================================

  SubjectDemographics:
    description: Demographic information for a subject
    slots:
      - id
      - subject_id
      - visit_id
      - age_years
      - age_months
      - age_gt89
      - sex
      - ethnicity
      - race
      - education_years
      - employment_status
      - marital_status
      - household_income

  SubjectAnthropometry:
    description: Anthropometric measurements for a subject
    slots:
      - id
      - subject_id
      - visit_id
      - height_cm
      - weight_kg
      - bmi
      - bmi_percentile
      - bmi_zscore
      - neck_circumference_cm
      - waist_circumference_cm
      - hip_circumference_cm
      - waist_hip_ratio

  SubjectVitalSigns:
    description: Vital sign measurements for a subject
    slots:
      - id
      - subject_id
      - visit_id
      - systolic_bp_mmhg
      - diastolic_bp_mmhg
      - heart_rate_bpm
      - respiratory_rate
      - temperature_celsius

  SubjectMedicalHistory:
    description: Medical history for a subject
    slots:
      - id
      - subject_id
      - has_hypertension
      - has_diabetes
      - has_heart_disease
      - has_stroke
      - has_depression
      - has_anxiety
      - has_insomnia
      - has_rls
      - has_narcolepsy
      - smoking_status
      - alcohol_use

  # ============================================================================
  # TREATMENT CLASSES
  # ============================================================================

  CPAPAdherence:
    description: CPAP treatment adherence data
    slots:
      - id
      - subject_id
      - visit_id
      - cpap_usage_hours
      - cpap_usage_percent_days
      - cpap_usage_percent_days_gt4h
      - cpap_pressure_cmh2o
      - cpap_ahi_residual
      - cpap_leak_lpm
      - time_frame

  # ============================================================================
  # ACTIGRAPHY CLASSES
  # ============================================================================

  ActigraphyRecord:
    description: Actigraphy-derived sleep measurements
    slots:
      - id
      - subject_id
      - visit_id
      - actigraphy_tst_min
      - actigraphy_se_pct
      - actigraphy_sol_min
      - actigraphy_waso_min
      - activity_count
      - rest_interval_start
      - rest_interval_end
      - valid_days
      - time_frame
      # Sleep fragmentation from actigraphy
      - sleep_fragmentation_index
      - sleep_bout_count
      - wake_bout_count
      - mean_sleep_bout_duration_min
      - mean_wake_bout_duration_min
      # Nap metrics
      - nap_count
      - nap_duration_total_min
      - nap_duration_mean_min

  # ============================================================================
  # SNORING MEASUREMENT CLASS
  # ============================================================================

  SnoringMetric:
    description: Snoring measurements from PSG or questionnaire
    slots:
      - id
      - subject_id
      - visit_id
      - snoring_frequency
      - snoring_loudness
      - snoring_duration_min
      - snoring_percent
      - snoring_index
      - psg_type

  # ============================================================================
  # CO2/CAPNOGRAPHY CLASS
  # ============================================================================

  CapnographyMetric:
    description: CO2/capnography measurements during sleep
    slots:
      - id
      - subject_id
      - visit_id
      - etco2_mean
      - etco2_peak
      - etco2_baseline_wake
      - etco2_baseline_sleep
      - time_co2_above_50_pct
      - time_co2_above_45_pct
      - sleep_stage
      - psg_type

  # ============================================================================
  # NEUROBEHAVIORAL PERFORMANCE CLASSES
  # ============================================================================

  PVTResult:
    description: Psychomotor Vigilance Test results
    slots:
      - id
      - subject_id
      - visit_id
      - pvt_mean_rt_ms
      - pvt_median_rt_ms
      - pvt_lapse_count
      - pvt_false_start_count
      - pvt_fastest_10pct_rt
      - pvt_slowest_10pct_rt
    attributes:
      test_duration_min:
        description: Duration of PVT test in minutes
        range: float
      time_of_day:
        description: Time of day when test was administered
        range: string

  SleepinessAssessment:
    description: Subjective sleepiness assessment
    slots:
      - id
      - subject_id
      - visit_id
      - kss_score
      - vas_sleepiness
      - ess_total_score
    attributes:
      assessment_time:
        description: Time of sleepiness assessment
        range: string

  # ============================================================================
  # SCREENING QUESTIONNAIRE CLASSES
  # ============================================================================

  BerlinQuestionnaireResult:
    description: Berlin Questionnaire results for OSA screening
    slots:
      - id
      - subject_id
      - visit_id
      - berlin_category1_positive
      - berlin_category2_positive
      - berlin_category3_positive
      - berlin_total_positive
      - berlin_risk

  STOPBANGResult:
    description: STOP-BANG questionnaire results for OSA screening
    slots:
      - id
      - subject_id
      - visit_id
      - stopbang_score
      - stopbang_risk
    attributes:
      snoring:
        description: S - Do you snore loudly?
        range: YesNoEnum
      tiredness:
        description: T - Do you often feel tired during the day?
        range: YesNoEnum
      observed_apnea:
        description: O - Has anyone observed you stop breathing?
        range: YesNoEnum
      high_bp:
        description: P - Do you have high blood pressure?
        range: YesNoEnum
      bmi_over_35:
        description: B - Is BMI > 35?
        range: YesNoEnum
      age_over_50:
        description: A - Is age > 50?
        range: YesNoEnum
      neck_over_40:
        description: N - Is neck circumference > 40cm?
        range: YesNoEnum
      male_gender:
        description: G - Is gender male?
        range: YesNoEnum

  # ============================================================================
  # PROMIS SLEEP SCORES CLASS
  # ============================================================================

  PROMISSleepScore:
    description: PROMIS sleep questionnaire scores
    slots:
      - id
      - subject_id
      - visit_id
      - promis_sleep_disturbance_tscore
      - promis_sleep_disturbance_raw
      - promis_sleep_impairment_tscore
      - promis_sleep_impairment_raw

  # ============================================================================
  # PEDIATRIC ASSESSMENT CLASSES
  # ============================================================================

  PediatricSleepAssessment:
    description: Pediatric-specific sleep questionnaire results
    slots:
      - id
      - subject_id
      - visit_id
      - chq_physical_score
      - chq_psychosocial_score
      - osa18_total_score
      - osa18_sleep_disturbance
      - osa18_physical_symptoms
      - osa18_emotional_distress
      - osa18_daytime_function
      - osa18_caregiver_concern
      - psq_srbd_score

  PediatricAnthropometry:
    description: Pediatric-specific anthropometric measurements
    slots:
      - id
      - subject_id
      - visit_id
      - age_months
      - gestational_age_weeks
      - height_cm
      - weight_kg
      - bmi
      - bmi_percentile
      - bmi_zscore
      - tonsil_size
      - adenoid_size

  # ============================================================================
  # VARIABLE MAPPING CLASS
  # ============================================================================

  VariableMapping:
    description: Mapping from a source variable to canonical CDE
    slots:
      - id
      - source_variable
      - dataset_id
      - canonical_slot
      - modifiers
      - mapping_confidence
      - mapping_notes
    attributes:
      source_label:
        description: Original variable label
        range: string
      source_concept_path:
        description: Original concept path
        range: string
      transformation:
        description: Any transformation applied
        range: string


# ==============================================================================
# SECTION E: DERIVED SLOT DEFINITIONS
# ==============================================================================

# Note: Only truly generic derived constructs are defined here.
# Dataset-specific composites should NOT be encoded in the schema.

# sleep_efficiency_pct is defined as a slot; the canonical formula is:
#   sleep_efficiency = (total_sleep_time_min / time_in_bed_min) * 100
# This is NOT encoded as equals_expression because it would require
# both slots to be present, which may not always be the case.
